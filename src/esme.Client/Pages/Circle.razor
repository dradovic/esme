@page "/circle/{Id:int}"
@inherits CircleBase
@using Store.Messages

@if (MessagesState.Value.ErrorMessage != null)
{
    <h1>Error</h1>
    <p>@MessagesState.Value.ErrorMessage</p>
}

@if (MessagesState.Value.State == State.IsLoading)
{
    <p>Loading...</p>
}

@if (MessagesState.Value.Messages != null)
{
    @foreach (var message in MessagesState.Value.Messages)
    {
        <div>
            <p>
                On @message.SentAt.ToString("g") @message.SenderName said:<br />
                @message.Text
            </p>
        </div>
    }
    <form onsubmit="@OnSubmit">
        <textarea required autofocus @bind="NewMessage.Text"></textarea> @*FIXME: da, specify maxlength*@
        <div class="col-sm-4 offset-sm-4 mb-2">
            @if (MessagesState.Value.State == State.RecordingAvailable)
            {
                <audio src="@MessagesState.Value.RecordingUrl" type="audio/mpeg" controls />
            }
            else if (MessagesState.Value.State == State.Default)
            {
                <button class="btn btn-lg btn-secondary btn-block" @onclick="@StartRecording">
                    Record
                </button>
            }
            else if (MessagesState.Value.State == State.IsRecording)
            {
                <button class="btn btn-lg btn-secondary btn-block" @onclick="@StopRecording">
                    Stop
                </button>
            }
        </div>
        <div class="col-sm-4 offset-sm-4 mb-2">
            <button class="btn btn-lg btn-primary btn-block" type="submit">Send</button>
        </div>
    </form>
}

