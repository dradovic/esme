@layout FlowerOfLifeLayout
@inherits LayoutComponentBase
@inject esme.Client.Services.AuthenticationState state
@inject IUriHelper uriHelper
@inject Blazor.Fluxor.IStore Store

@Store.Initialize()

@if (IsLoggedIn)
{
    <button type="button" class="btn btn-link ml-md-auto" onclick="@LogoutClick">Logout @state.User.UserName</button>
    <div class=" col-sm-4 offset-sm-4 mb-2">
        @Body
    </div>
}

@code{
    protected bool IsLoggedIn;
    protected override async Task OnInitAsync()
    {
        IsLoggedIn = await state.IsLoggedIn();
        if (!IsLoggedIn)
        {
            uriHelper.NavigateTo("/login");
        }
    }

    async Task LogoutClick()
    {
        await state.Logout();
        uriHelper.NavigateTo("/login");
    }
}