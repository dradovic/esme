@layout FlowerOfLifeLayout
@inherits LayoutComponentBase
@inject AuthenticationState state
@inject IUriHelper uriHelper
@inject Blazor.Fluxor.IStore Store

@Store.Initialize()

@if (IsLoggedIn)
{
    <button type="button" class="btn btn-link ml-md-auto" onclick="@LogoutClick">Logout</button>
    @Body
}

@functions{
    protected bool IsLoggedIn;
    protected override async Task OnInitAsync()
    {
        IsLoggedIn = await state.IsLoggedIn();
        if (!IsLoggedIn)
        {
            uriHelper.NavigateTo("/login");
        }
    }

    async Task LogoutClick()
    {
        await state.Logout();
        uriHelper.NavigateTo("/login");
    }
}